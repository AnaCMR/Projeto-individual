<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ana's Garden - Fale conosco</title>
  <link rel="stylesheet" href="css/contato.css" />
  <link rel="icon" href="icons/plant.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel&family=Courgette&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

  <script src="./js/funcoes.js"></script>

</head>

<body>
  <div class="container">
    <header class="header">
      <div class="logo-div">
        <a href="index.html">
          <img class="logo" src="icons/logo.png" alt="logo" />
        </a>
      </div>
      <nav class="container">
        <ul class="navbar">

          <li><a href="index.html"> Home</a></li>
          <li><a href="artigo-lista.html"> Artigos</a></li>
          
        </ul>
      <button class="login" onclick="login()">Login</button>
      <button onclick="cadastro()">Cadastre-se</button>
      </nav>
    </header>
  </div>
  <div class="space"> <br><br>.</div>
  <div id="blur_div_cadastro">
    .
    <div id="cadastro_div">
      <p class="close" onclick="back_cadastro()">X</p>
      <!-- <form id="form_cadastro" method="post"  onsubmit="return cadastrar()"> -->
        <label class="login_label">Nome:</label><br />
        <input name="nome" class="login_input" id="name_user" /><br />
        <label class="login_label">E-mail:</label><br />
        <input name="email" class="login_input" id="user_email" /><br />
        <div class="div_perfil">
          <div class="age_data">
            <label class="login_label">Data Nascimento:</label><br />
            <input
              name="idade"
              type="date"
              class="login_input age"
              id="age_input"
            /><br />
          </div>
          <div class="gender_data">
            <label class="genero">Gênero</label><br />
            <select class="login_select_gender" id="gender_select">
              <option value="">Selecione...</option>
              <option value="f">F</option>
              <option value="m">M</option>
              <option value="nao informado">Prefiro não informar</option>
            </select> 
          </div>
        </div>
        <label class="login_label">Senha:</label><br />
        <input
        title="mostrar senha"
          name="senha"
          class="login_input"
          type="password"
          id="password_user"
        />
        <img
        id="olho_aberto_cadastro1"
        title="ocultar senha"
        class="olho_aberto"
        src="icons/see.png"
        onclick="changeImage()"
        alt="mudar para senha visivel"
      />
      <img
        id="olho_fechado_cadastro1"
        class="olho_fechado"
        onclick="ver()"
        src="icons/cloudy.png"
        alt="mudar para senha não visivel"
      />
<br />

        <label class="login_label">Confirmar senha:</label><br />
        <input
          class="login_input"
          name="confirmacao-senha"
          type="password"
          id="confirm_password"
          title="mostrar senha"
        /><img
        id="olho_aberto_cadastro2"
        class="olho_aberto"
        src="icons/see.png"
        onclick="changeImage()"
        alt="mudar para senha visivel"
      />
      <img
        id="olho_fechado_cadastro2"
        class="olho_fechado"
        title="ocultar senha"
        onclick="ver()"
        src="icons/cloudy.png"
        alt="mudar para senha não visivel"
      /><br />

        <br />

        <button class="welcome" onclick="cadastrar()">Cadastrar-se</button>
      <!-- </form> -->
    </div>
    <div id="div_aguardar" class="loading-div">
      
  </div>

  <div id="div_erros_login"></div>

  </div>

  <div id="blur_div">
    .
    <div id="login_div">
      <p class="close" onclick="back_login()">X</p>
      <form id="form_login" method="post" onsubmit="return entrar()">
        <label class="login_label">E-mail:</label><br />
        <input name="email_login" class="login_input" id="user_email_login" /><br />
        <label class="login_label">Senha:</label><br />
        <input
          name="senha_login"
          class="login_input"
          type="password"
          id="password_user_login"
        /><img
        id="olho_aberto_login"
        title="mostrar senha"
        class="olho_aberto"
        src="icons/see.png"
        onclick="changeImage()"
        alt="mudar para senha visivel"
      />
      <img
        id="olho_fechado_login"
        class="olho_fechado"
        title="ocultar senha"
        onclick="ver()"
        src="icons/cloudy.png"
        alt="mudar para senha não visível"
      /><br />
        <br />
        <button class="welcome" type="submit">
          Entrar
        </button>
      </form>
    </div>
    <div id="div_aguardar" class="loading-div">
      
  </div>

  <div id="div_erros_login"></div>
  </div>

  <section class="contact">

      <div class="container_contact">
    <label>Selecione o motivo do contato:</label> <br> <br>
        <select id="motive_contact" onchange="options_contact()">
            <option value="">Selecione...</option>
        <option value="experiencia">Quero compartilhar minha experiência</option>
        <option value="gosto">Não gostei de algum conteúdo</option>
        <option value="contato">Gostaria de falar com o criador da página </option>
    </select>
    <br><br>


    <div id="history_div">
        <form action="">
          <label>Email:</label> <br>
          <input id="email_contact" class="login_input"> <br> <br>
          <label>Texto:</label> <br> <br>
        <textarea id="text_contact" class="history_text"  id="historia_text" cols="60" rows="20"></textarea>
        
        <button onclick="contatar()" >Enviar</button>
    </form>
    </div>

</div>
<div class="photo" >
  <img src="https://c.tenor.com/q2lP9vEriZUAAAAC/party-plants.gif" alt="">
</div>
  </section>

  <footer id="footer">
    <p>Ana Marques &copy; 2021</p>
    <p>Todos os direitos reservados</p>
    </footer>

    <script src="js/functions.js"></script>
</body>

</html>
<script>
//   function limparFormulario() {
// document.getElementById("form_cadastro").reset();
// }


function cadastrar() {
aguardar();

// var formulario = new FormData(document.getElementById("form_cadastro"));

var nomeVar = name_user.value;
var emailVar = user_email.value;
var senhaVar = password_user.value;
var confirmacaoSenha = confirm_password.value;
var idadeVar = age_input.value
var generoVar = gender_select.value

if (nomeVar == "" || emailVar == "" || senhaVar == "" || confirmacaoSenha == "") {

  window.alert("Preencha todos os campos para prosseguir!");
  if (nomeVar == "") {
      console.log('nome está em branco')
  }
  if (emailVar == "") {
      console.log('email está em branco')
  }
  if (senhaVar == "") {
      console.log('senha está em branco')
  }
  if (confirmacaoSenha == "") {
      console.log('confirmacaoSenha está em branco')
  }
  if (idadeVar == "") {
      console.log('idade está em branco')
  }
  if (generoVar == "") {
      console.log('genero está em branco')
  }
  finalizarAguardar();
  return false;
}

 if (emailVar.indexOf("@") == -1 || emailVar.indexOf(".com") == -1) {
   window.alert("Ops, e-mail inválido! Verifique e tente novamente.");
   finalizarAguardar();
   return false;
 }

if (senhaVar != confirmacaoSenha) {
  window.alert("As senhas inseridas devem ser iguais para prosseguir!");
  finalizarAguardar();
  return false;
}

fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nome: nomeVar,
                email: emailVar,
                senha: senhaVar,
                idade: idadeVar,
                genero: generoVar,
            })
          }).then(function (resposta) {

  console.log("resposta: ", resposta);

  if (resposta.ok) {
      window.alert("Cadastro realizado com sucesso!");
      location.reload();
      limparFormulario();
      finalizarAguardar();
  } else {
      throw ("Houve um erro ao tentar realizar o cadastro!");
  }
}).catch(function (resposta) {
  console.log(`#ERRO: ${resposta}`);
  finalizarAguardar();
});

return false;
}
 
function limparFormulario() {
        document.getElementById("form_login").reset();
    }

    function entrar() {
        aguardar();

        var formulario = new URLSearchParams(new FormData(document.getElementById("form_login")));

        var email = formulario.get("email_login");
        var senha = formulario.get("senha_login");

        console.log("FORM LOGIN: ", email);
        console.log("FORM SENHA: ", senha);

        // TODO: VERIFICAR AS VALIDAÇÕES QUE ELES ESTÃO APRENDENDO EM ALGORITMOS 
        if (email == "" || senha == "") {
            window.alert("Preencha todos os campos para prosseguir!");
            finalizarAguardar();
            return false;
        }

        if (email.indexOf("@") == -1 || email.indexOf(".com") == -1) {
            window.alert("Ops, e-mail inválido! Verifique e tente novamente.");
            finalizarAguardar();
            return false;
        }

        fetch("/usuarios/autenticar", {
            method: "POST",
            body: formulario
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.id;

                    setTimeout(function () {
                      if (email == "ana.silva@bandtec.com.br"){
                        window.location = "./dashboard.html";
                      } else {
                        window.location = "./tela-perfil.html"
                      }
                    }, 1000); // apenas para exibir o loading

                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    alert(texto);
                    finalizarAguardar(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    function contatar(){
      var motivovar = motive_contact.value;
      var emailvar = email_contact.value;
      var textvar = text_contact.value;

      if (emailvar == "" || text == "") {

window.alert("Preencha todos os campos para prosseguir!");
if (emailvar == "") {
    console.log('email está em branco')
}
if (textvar == "") {
    console.log('text está em branco')
}

finalizarAguardar();
return false;
}

fetch("/usuarios/contatar", {
          method: "POST",
          headers: {
              "Content-Type": "application/json"
          },
          body: JSON.stringify({
              motivo: motivovar,
              email: emailvar,
              texto: textovar,
          })
        }).then(function (resposta) {

console.log("resposta: ", resposta);

if (resposta.ok) {
    window.alert("Informação enviada com sucesso!");
    location.reload();
    limparFormulario();
    finalizarAguardar();
} else {
    throw ("Houve um erro ao tentar realizar o cadastro!");
}
}).catch(function (resposta) {
console.log(`#ERRO: ${resposta}`);
finalizarAguardar();
});

return false;
}


    

</script>